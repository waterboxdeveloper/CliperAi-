version: '3.8'

services:
  cliper:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: cliper_app
    environment:
      # Mount your Google Gemini API Key from your host environment
      # IMPORTANT: Replace 'your_gemini_api_key_here' with your actual key
      # or better, set it in your host's .env file and reference it here:
      # - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      GOOGLE_API_KEY: "AIzaSyBBqc3cgNG6DEI7HV-JBkQ0oIdCO9yjdY4"
      # Optional: Configure Whisper model size
      WHISPER_MODEL: "base"
      # Optional: Set log level for debugging
      LOG_LEVEL: "INFO"
    volumes:
      # Mount the current project directory into the container
      # This allows CLIPER to access your input videos and save outputs
      - .:/app
      # Mount a dedicated volume for WhisperX models to persist them
      # This prevents re-downloading models every time the container starts
      - cliper_whisper_models:/root/.cache/whisperx
    # If you need GPU support for WhisperX (highly recommended for performance)
    # uncomment the following lines and ensure your Docker setup supports NVIDIA GPUs
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: all
    #           capabilities: [gpu]
    stdin_open: true # Keep stdin open for interactive CLI
    tty: true        # Allocate a pseudo-TTY for interactive CLI

volumes:
  cliper_whisper_models:
    driver: local
